(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{640:(e,t,n)=>{"use strict";n.d(t,{Cx:()=>l});var i=n(1681),a=n(7358);let o=["function createGame(address _opponent) payable returns (uint256)","function joinGame(uint256 gameId) payable","function reportResult(uint256 gameId, uint8 _result)","function raiseDispute(uint256 gameId)","function resolveDispute(uint256 gameId, uint8 _result)","function claimTimeout(uint256 gameId)","function refundUnjoinedGame(uint256 gameId)","event GameCreated(uint256 indexed gameId, address indexed player1, address indexed player2, uint256 wager)","event GameJoined(uint256 indexed gameId, address indexed player2)","event GameFinished(uint256 indexed gameId, uint8 result, address winner)","event DisputeRaised(uint256 indexed gameId, address indexed raiser)","event DisputeResolved(uint256 indexed gameId, uint8 result, address winner)","event GameRefunded(uint256 indexed gameId, address indexed player1)"],r=a.env.NEXT_PUBLIC_CHESS_WAGER_ESCROW_ADDRESS;function l(e){return new i.NZ(r,o,e)}},738:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>h});var i=n(5155),a=n(2115),o=n(3761),r=n(3912),l=n(4724),s=n(2062),d=n(640),c=n(5219);function u(e){let{initialSeconds:t,isRunning:n,onTimeout:o,keyProp:r}=e,[l,s]=(0,a.useState)(t),d=(0,a.useRef)(null);(0,a.useEffect)(()=>{s(t)},[t,r]),(0,a.useEffect)(()=>{if(!n){d.current&&clearInterval(d.current);return}return d.current=setInterval(()=>{s(e=>e<=1?(o(),d.current&&clearInterval(d.current),0):e-1)},1e3),()=>{d.current&&clearInterval(d.current)}},[n,o]);let c=Math.floor(l/60),u=l<10;return(0,i.jsxs)("span",{className:"font-mono text-lg",style:{color:u?"var(--danger, red)":void 0,fontWeight:u?"bold":void 0},"aria-live":"polite",children:[c,":",(l%60).toString().padStart(2,"0")]})}function m(e){let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))}function f(e){let{fen:t,whiteName:n,blackName:a,whiteTime:o,blackTime:r,status:s}=e;return(0,i.jsxs)("div",{className:"bg-black bg-opacity-60 rounded-lg p-4 flex flex-col items-center w-fit",children:[(0,i.jsxs)("div",{className:"flex justify-between w-full mb-2",children:[(0,i.jsxs)("span",{className:"text-white font-bold",children:[n," (",m(o),")"]}),(0,i.jsxs)("span",{className:"text-white font-bold",children:[a," (",m(r),")"]})]}),(0,i.jsx)(l.Ve,{position:t,boardWidth:400,arePiecesDraggable:!1,boardOrientation:"white"}),"active"!==s&&(0,i.jsxs)("div",{className:"mt-2 text-lg text-red-400",children:["Game Over: ",s]})]})}function g(e){return"object"==typeof e&&null!==e&&"request"in e&&"function"==typeof e.request}function h(){var e,t,n;let[m,h]=(0,a.useState)(!1),[p,w]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null),{address:y,status:x}=(0,o.DK)(),[j,S]=(0,a.useState)(new r.d$),[k,I]=(0,a.useState)(null),[_,N]=(0,a.useState)(null),[R,E]=(0,a.useState)(null),[B]=(0,a.useState)(300),[W]=(0,a.useState)(300),[D,C]=(0,a.useState)("w"),[z,G]=(0,a.useState)("active"),[O]=(0,a.useState)(null),[T,M]=(0,a.useState)(null),[A,q]=(0,a.useState)(null),[F,U]=(0,a.useState)(!1),[P,L]=(0,a.useState)(null),[J,Y]=(0,a.useState)(!1);async function X(e){if("active"!==z)return;let t=new r.d$(j.fen());console.log("[DEBUG] makeAMove - FEN before move:",j.fen(),"Move:",e);let n=t.move(e);if(console.log("[DEBUG] makeAMove - FEN after move:",t.fen(),"Move result:",n),n&&n.captured&&(L({piece:n.captured,color:"w"===n.color?"b":"w"}),Y(!0),setTimeout(()=>Y(!1),2e3)),S(t),n&&k){let e=t.history().length;await s.N.from("moves").insert([{game_id:k,move_number:e,move:n.san}]),C(t.turn()),"BOT"===T&&"b"===t.turn()&&"active"===z&&setTimeout(async()=>{let e=new r.d$(t.fen()),n=e.moves();if(n.length){let t=n[Math.floor(Math.random()*n.length)];e.move(t);let i=e.history().length;await s.N.from("moves").insert([{game_id:k,move_number:i,move:t}]),S(e),C(e.turn())}},650)}return n}async function Z(){G("timeout"),k&&await s.N.from("games").update({status:"timeout"}).eq("id",k)}return((0,a.useEffect)(()=>{let e=new URLSearchParams(window.location.search).get("gameId");if(I(e),!e)return;let t=async()=>{"waiting"===z&&e&&y&&(!T||"BOT"===T)&&await s.N.from("games").delete().eq("id",e)};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}},[y,T,z]),(0,a.useEffect)(()=>{"waiting"===z&&T&&p&&m&&!v&&k&&(async()=>{let e=.5>Math.random()?"w":"b",{data:t}=await s.N.from("games").select("white_player,black_player,white_player_id,black_player_id").eq("id",k).single();if(!t)return;console.log("[DEBUG] assignColors - gameData:",t,"address:",y,"myColor:",e),y===t.white_player&&"w"===e&&console.warn("[DEBUG] Attempting to set both players to white:",{address:y,gameData:t});let n={white_player:"w"===e?y:t.black_player,black_player:"b"===e?y:t.white_player,white_player_id:"w"===e?t.white_player_id:t.black_player_id,black_player_id:"b"===e?t.white_player_id:t.black_player_id,status:"ready",assigned:!0};console.log("[DEBUG] assignColors - update:",n),await s.N.from("games").update(n).eq("id",k),b(e)})()},[z,T,p,m,v,y,k]),(0,a.useEffect)(()=>{if("ready"===z&&v){q(5);let e=setInterval(()=>{q(t=>null===t?null:t<=1?(clearInterval(e),G("active"),null):t-1)},1e3);return()=>clearInterval(e)}},[z,v]),"1"===new URLSearchParams(window.location.search).get("overlay"))?(0,i.jsx)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-transparent",children:(0,i.jsx)(f,{fen:j.fen(),whiteName:"White",blackName:"Black",whiteTime:B,blackTime:W,status:z})}):(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",justifyContent:"center",width:"100vw",background:"var(--background)"},children:[(0,i.jsxs)("div",{className:"card",style:{padding:"2.5em 2em",background:"var(--card-bg)",border:"1px solid var(--accent)",boxShadow:"0 0 24px #4f8cff33",width:"100%",maxWidth:560,minWidth:0,boxSizing:"border-box"},"aria-label":"Chess game area",tabIndex:0,children:[P&&J&&(0,i.jsx)("div",{style:{position:"absolute",top:24,left:0,right:0,margin:"0 auto",width:80,height:80,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,fontSize:64,opacity:+!!J,transition:"opacity 0.5s",pointerEvents:"none",color:(null==P?void 0:P.color)==="w"?"#fff":"#222",textShadow:"0 2px 8px #000"},children:{p:(null==P?void 0:P.color)==="w"?"♙":"♟",n:(null==P?void 0:P.color)==="w"?"♘":"♞",b:(null==P?void 0:P.color)==="w"?"♗":"♝",r:(null==P?void 0:P.color)==="w"?"♖":"♜",q:(null==P?void 0:P.color)==="w"?"♕":"♛",k:(null==P?void 0:P.color)==="w"?"♔":"♚"}[null!=(n=null==P?void 0:P.piece)?n:""]||"?"}),k&&(0,i.jsxs)("div",{style:{marginBottom:"1em",color:"var(--accent-2)",fontFamily:"var(--font-mono)",fontSize:"1.1em"},children:["Game ID: ",k]}),"waiting"===z&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{marginBottom:"1em",color:"var(--accent)",fontWeight:600,textAlign:"center"},children:["Waiting for an opponent to join...",(0,i.jsx)("br",{}),"Share this link: ",(0,i.jsx)("span",{style:{fontFamily:"var(--font-mono)"},children:window.location.href})]}),(0,i.jsx)("button",{style:{marginBottom:24,width:"100%",background:"#ff4d4f",color:"#fff",fontWeight:700,padding:"0.75em",borderRadius:8,border:"none",fontSize:"1.1em",cursor:F?"not-allowed":"pointer",opacity:F?.7:1},disabled:F,onClick:async()=>{k&&(U(!0),await s.N.from("games").delete().eq("id",k),window.removeEventListener("beforeunload",()=>{}),window.location.href="/lobby")},children:"Leave Lobby"}),(0,i.jsxs)("div",{style:{marginTop:24,textAlign:"center"},children:[(0,i.jsx)("button",{style:{background:m?"#4caf50":"#1976d2",color:"#fff",fontWeight:700,padding:"0.75em",borderRadius:8,border:"none",fontSize:"1.1em",cursor:m?"not-allowed":"pointer",opacity:m?.7:1,marginRight:16},disabled:m,onClick:async()=>{if(!k)return;let e=y===T?"ready_black":"ready_white";await s.N.from("games").update({[e]:!0}).eq("id",k),h(!0)},children:m?"Ready!":"I am Ready"}),(0,i.jsx)("span",{style:{marginLeft:8,color:p?"#4caf50":"#aaa",fontWeight:600},children:p?"Opponent Ready":"Waiting for Opponent"})]})]}),"ready"===z&&(0,i.jsx)("div",{style:{marginBottom:"1em",color:"var(--accent)",fontWeight:600,textAlign:"center"},children:"Both players are ready! Assigning colors and starting soon..."}),"number"==typeof A&&A>0&&(0,i.jsxs)("div",{style:{marginBottom:"1em",color:"var(--accent)",fontWeight:600,textAlign:"center"},children:["Opponent joined! Game starting in ",A," second",1!==A?"s":"","..."]}),"connected"===x&&y&&(0,i.jsxs)("div",{style:{color:"var(--accent-2)",fontFamily:"var(--font-mono)",fontSize:"1.1em",marginBottom:"1em"},children:["Your Address: ",null!=(e=null==y?void 0:y.slice(0,6))?e:"","...",null!=(t=null==y?void 0:y.slice(-4))?t:""]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:24,gap:32},children:[(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:700,color:"var(--accent)"},children:"White"}),(0,i.jsx)(u,{initialSeconds:B,isRunning:"w"===D&&"active"===z,onTimeout:Z,keyProp:"white-".concat(k)})]}),(0,i.jsxs)("div",{style:{textAlign:"center"},children:[(0,i.jsx)("span",{style:{fontWeight:700,color:"var(--accent)"},children:"Black"}),(0,i.jsx)(u,{initialSeconds:W,isRunning:"b"===D&&"active"===z,onTimeout:Z,keyProp:"black-".concat(k)})]})]}),R&&(0,i.jsx)("div",{style:{color:"#fff",background:"#ff4d4f",padding:"0.5em 1em",borderRadius:8,marginBottom:10,fontWeight:600,boxShadow:"0 2px 8px #ff4d4f55",zIndex:20},children:R}),O&&(0,i.jsx)("div",{style:{color:"#fff",background:"#1976d2",padding:"0.5em 1em",borderRadius:8,marginBottom:10,fontWeight:600,boxShadow:"0 2px 8px #1976d255",zIndex:20},children:O}),O&&(0,i.jsx)("div",{style:{color:"#fff",background:"#1976d2",padding:"0.5em 1em",borderRadius:8,marginBottom:10,fontWeight:600,boxShadow:"0 2px 8px #1976d255",zIndex:20},children:O}),(0,i.jsx)("div",{style:{marginBottom:24},children:(0,i.jsx)(l.Ve,{position:j.fen(),onPieceDrop:(e,t)=>"active"!==z||A?(E("You cannot move: Game is not active."),setTimeout(()=>E(null),1200),!1):new r.d$(j.fen()).move({from:e,to:t,promotion:"q"})?(N({from:e,to:t}),X({from:e,to:t,promotion:"q"}),!0):(E("Illegal move!"),setTimeout(()=>E(null),1200),!1),boardWidth:480,arePiecesDraggable:"active"===z&&!A&&!!T,customBoardStyle:{borderRadius:12,boxShadow:"0 0 24px #4f8cff33",transition:"box-shadow 0.3s"},animationDuration:250,boardOrientation:"b"===v?"black":"white",showBoardNotation:!0,customSquareStyles:_?{[_.from]:{background:"radial-gradient(circle, #ffe082 70%, transparent 100%)"},[_.to]:{background:"radial-gradient(circle, #81d4fa 70%, transparent 100%)"}}:{}})}),(0,i.jsx)("button",{style:{marginBottom:24,width:"100%",background:"var(--accent)",color:"#fff",fontWeight:700,padding:"0.75em",borderRadius:8,border:"none",fontSize:"1.1em",cursor:"active"===z?"pointer":"not-allowed",opacity:"active"===z?1:.5,outline:"2px solid transparent"},disabled:"active"!==z,"aria-label":"Forfeit game",tabIndex:0,onFocus:e=>e.currentTarget.style.outline="2px solid #4f8cff",onBlur:e=>e.currentTarget.style.outline="2px solid transparent",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&e.currentTarget.click()},onClick:async()=>{"active"===z&&k&&(await s.N.from("games").update({status:"forfeited"}).eq("id",k),G("forfeited"))},children:"Forfeit"}),"active"===z&&(0,i.jsxs)("div",{style:{marginBottom:16,marginTop:8,textAlign:"center"},children:[(0,i.jsx)("button",{style:{background:"#4caf50",color:"#fff",fontWeight:700,padding:"0.5em 1.5em",borderRadius:8,border:"none",fontSize:"1em",marginRight:10},onClick:async()=>{if(k&&window.ethereum)try{if(!g(window.ethereum))throw Error("No EIP-1193 provider");let e=new c.k(window.ethereum),t=await e.getSigner(),n=(0,d.Cx)(t),i=window.prompt("Enter result: 1=You win, 2=Opponent wins, 3=Draw");if(!i)return;let a=await n.reportResult(Number(k),Number(i));await a.wait(),alert("Result reported on-chain!")}catch(e){alert("Failed to report result on-chain: "+e.message)}},children:"Report Result (On-chain)"}),(0,i.jsx)("button",{style:{background:"#ff9800",color:"#fff",fontWeight:700,padding:"0.5em 1.5em",borderRadius:8,border:"none",fontSize:"1em"},onClick:async()=>{if(k&&window.ethereum)try{if(!g(window.ethereum))throw Error("No EIP-1193 provider");let e=new c.k(window.ethereum),t=await e.getSigner(),n=(0,d.Cx)(t),i=await n.raiseDispute(Number(k));await i.wait(),alert("Dispute raised on-chain!")}catch(e){alert("Failed to raise dispute: "+e.message)}},children:"Raise Dispute (On-chain)"})]}),(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",color:"var(--foreground)",fontWeight:600,textAlign:"center",marginBottom:6},children:[(0,i.jsx)("span",{style:{display:"inline-block",width:14,height:14,borderRadius:"50%",background:"w"===D?"#fff":"#222",border:"2px solid #4f8cff",marginRight:8}}),"active"===z?("w"===D?"White":"Black")+" to move":"Game status: ".concat(z)]})]})}},2062:(e,t,n)=>{"use strict";n.d(t,{N:()=>i});let i=(0,n(851).UU)("https://ospgpgpahqgalaufcomo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zcGdwZ3BhaHFnYWxhdWZjb21vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU1NzYzMzIsImV4cCI6MjA2MTE1MjMzMn0.houQzJX0k4S9MbnPODy13rK8oIXq-QwuuRxD9lOjE9s")},3631:(e,t,n)=>{Promise.resolve().then(n.bind(n,738))}},e=>{var t=t=>e(e.s=t);e.O(0,[989,134,761,851,219,912,441,684,358],()=>t(3631)),_N_E=e.O()}]);