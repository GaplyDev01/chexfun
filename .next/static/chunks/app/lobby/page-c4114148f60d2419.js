(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33],{640:(e,t,a)=>{"use strict";a.d(t,{Cx:()=>s});var n=a(1681),i=a(7358);let r=["function createGame(address _opponent) payable returns (uint256)","function joinGame(uint256 gameId) payable","function reportResult(uint256 gameId, uint8 _result)","function raiseDispute(uint256 gameId)","function resolveDispute(uint256 gameId, uint8 _result)","function claimTimeout(uint256 gameId)","function refundUnjoinedGame(uint256 gameId)","event GameCreated(uint256 indexed gameId, address indexed player1, address indexed player2, uint256 wager)","event GameJoined(uint256 indexed gameId, address indexed player2)","event GameFinished(uint256 indexed gameId, uint8 result, address winner)","event DisputeRaised(uint256 indexed gameId, address indexed raiser)","event DisputeResolved(uint256 indexed gameId, uint8 result, address winner)","event GameRefunded(uint256 indexed gameId, address indexed player1)"],l=i.env.NEXT_PUBLIC_CHESS_WAGER_ESCROW_ADDRESS;function s(e){return new n.NZ(l,r,e)}},2062:(e,t,a)=>{"use strict";a.d(t,{N:()=>n});let n=(0,a(851).UU)("https://ospgpgpahqgalaufcomo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zcGdwZ3BhaHFnYWxhdWZjb21vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU1NzYzMzIsImV4cCI6MjA2MTE1MjMzMn0.houQzJX0k4S9MbnPODy13rK8oIXq-QwuuRxD9lOjE9s")},6419:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var n=a(5155),i=a(2115),r=a(5695),l=a(2062),s=a(1368),d=a(640),o=a(5219),c=a(2741),u=a(3761),g=a(1828);let m=()=>{let[e,t]=i.useState(()=>localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));return i.useEffect(()=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},[e]),(0,n.jsx)("button",{onClick:()=>t("dark"===e?"light":"dark"),style:{background:"var(--accent-2)",color:"#0d1117",borderRadius:6,padding:"6px 16px",fontWeight:600,marginLeft:8},"aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",title:"dark"===e?"Switch to light mode":"Switch to dark mode",children:"dark"===e?"\uD83C\uDF19 Dark":"☀️ Light"})},h=["#4f8cff","#a259ff","#f24e1e","#43b97f","#fbbc05","#ff6d00"];function p(e){var t;let{name:a}=e,i=function(e){if(!e)return"?";let t=e.split(" ");return t.length>1?t[0][0]+t[1][0]:e.slice(0,2).toUpperCase()}(a),r=h[(null!=(t=null==a?void 0:a.charCodeAt(0))?t:0)%h.length];return(0,n.jsx)("span",{style:{display:"inline-block",width:28,height:28,borderRadius:"50%",background:r,color:"#fff",textAlign:"center",lineHeight:"28px",fontWeight:600,marginRight:8},children:i})}let f=i.memo(function(e){let{games:t,onlineUsers:a,onJoin:r,onCreateGame:l,loading:s}=e,[d,o]=(0,i.useState)("wager"),c=(0,i.useMemo)(()=>{if(!t)return[];switch(d){case"rating":return[...t].sort((e,t)=>(t.white_player_rating||0)-(e.white_player_rating||0));case"status":return[...t].sort((e,t)=>e.status.localeCompare(t.status));default:return[...t].sort((e,t)=>(t.wager||0)-(e.wager||0))}},[t,d]);return s?(0,n.jsx)("li",{style:{textAlign:"center",padding:"2em 0"},"aria-busy":"true",children:"Loading games..."}):c.length?(0,n.jsxs)("ul",{style:{listStyle:"none",padding:0,margin:0},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",margin:"8px 0 16px 0"},children:[(0,n.jsx)("label",{htmlFor:"sort-games",style:{marginRight:8},children:"Sort by:"}),(0,n.jsxs)("select",{id:"sort-games",value:d,onChange:e=>o(e.target.value),style:{marginRight:16},"aria-label":"Sort games",children:[(0,n.jsx)("option",{value:"wager",children:"Wager"}),(0,n.jsx)("option",{value:"rating",children:"Rating"}),(0,n.jsx)("option",{value:"status",children:"Status"})]})]}),c.map(e=>(0,n.jsxs)("li",{className:"card",tabIndex:0,style:{marginBottom:"1.5em",padding:"1em 1.5em",display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--card-bg)",border:"1px solid var(--accent)",boxShadow:"0 0 12px #4f8cff33"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,n.jsx)(p,{name:e.white_player}),(0,n.jsx)("span",{style:{fontWeight:600,color:"var(--accent-2)"},children:"Game ID:"})," ",(0,n.jsxs)("span",{style:{fontFamily:"var(--font-mono)",fontSize:"1.1em"},children:[e.id.slice(0,8),"..."]}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{style:{color:"var(--foreground)",fontSize:"0.95em",marginLeft:8},children:["White: ",(0,n.jsx)("b",{children:e.white_player})," ",e.white_player&&a.includes(e.white_player)?"\uD83D\uDFE2":"⚪"," ",e.black_player?"vs ":""]}),e.black_player&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p,{name:e.black_player}),(0,n.jsxs)("span",{style:{fontSize:"0.95em"},children:[(0,n.jsx)("b",{children:e.black_player})," ",a.includes(e.black_player)?"\uD83D\uDFE2":"⚪"]})]})]}),(0,n.jsx)("button",{style:{background:"var(--accent-2)",color:"#0d1117",minWidth:100},onClick:()=>r(e),disabled:!!e.black_player,"aria-label":e.black_player?"Game already joined":"Join this game",title:e.black_player?"This game already has two players.":"Join this game",children:"Join"})]},e.id))]}):(0,n.jsxs)("li",{style:{color:"var(--foreground)",textAlign:"center",padding:"2em 0"},children:["No games available.",(0,n.jsx)("br",{}),l&&(0,n.jsx)("button",{onClick:l,style:{marginTop:12,background:"var(--accent-2)",color:"#0d1117",fontWeight:600,padding:"8px 20px",borderRadius:6},"aria-label":"Create new game",title:"Create a new game",children:"+ Create Game"})]})});var y=a(9884),w=a(8007);let x=e=>{let{onPlay:t}=e;return(0,n.jsx)("button",{onClick:t,style:{background:"var(--accent-2)",color:"#0d1117",fontWeight:600,padding:"8px 20px",borderRadius:6,margin:"8px 0"},"aria-label":"Play vs Bot",title:"Play a game against a computer bot",children:"\uD83E\uDD16 Play vs Bot"})};function b(){let e=(0,r.useRouter)(),[t,a]=(0,i.useState)(.01),[h,p]=(0,i.useState)(0),[b,_]=(0,i.useState)(3e3),[v,j]=(0,i.useState)(null),{address:I}=(0,u.DK)(),k=function(e){let[t,a]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let t,n;if(e)return i(),r(),t=setInterval(i,3e4),n=setInterval(r,3e4),()=>{clearInterval(t),clearInterval(n)};async function i(){e&&await l.N.from("users").update({last_seen:new Date().toISOString()}).eq("wallet_address",e)}async function r(){let{data:e}=await l.N.from("users").select("wallet_address,last_seen"),t=Date.now();a((e||[]).filter(e=>e.last_seen&&t-new Date(e.last_seen).getTime()<12e4).map(e=>e.wallet_address||""))}},[e]),t}(null!=I?I:null),{games:S,loading:R,error:C}=function(e,t){let[a,n]=(0,i.useState)([]),[r,s]=(0,i.useState)(!0),[d,o]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let t=l.N.from("games").select("*");e.status&&(t=t.eq("status",e.status)),e.wager&&(t=t.gte("wager",.8*e.wager).lte("wager",1.2*e.wager)),t.then(t=>{let{data:a,error:i}=t;if(i)o(i.message);else{let t=a||[];void 0!==e.minRating&&void 0!==e.maxRating&&(t=t.filter(t=>null===t.white_player_rating||t.white_player_rating>=e.minRating&&t.white_player_rating<=e.maxRating)),n(t)}s(!1)})},[e.status,e.minRating,e.maxRating,e.wager,t]),{games:a,loading:r,error:d}}({status:"waiting",minRating:h,maxRating:b,wager:t},null==v?void 0:v.id);async function N(){var a,n,i,r,u;if(!v)return;let g=(0,s.A)();if("object"==typeof(a=window.ethereum)&&null!==a&&"request"in a&&"function"==typeof a.request&&I)try{let a=new o.k(window.ethereum),s=await a.getSigner(),m=(0,d.Cx)(s),h=window.prompt("Enter opponent wallet address for escrow game:");if(!h)return;let p=c.g5(t.toString()),f=await m.createGame(h,{value:p}),y=null==(n=(await f.wait()).logs)?void 0:n.find(e=>"GameCreated"===e.eventName),w=null!=(u=null==y||null==(r=y.args)||null==(i=r.gameId)?void 0:i.toString())?u:g;alert("On-chain game created! Game ID: "+w),await l.N.from("games").insert([{id:w,white_player:v.wallet_address,white_player_id:v.id,black_player:h,black_player_id:null,fen:"startpos",status:"waiting",wager:t,white_player_rating:v.rating}]),e.push("/chessboard?gameId=".concat(w));return}catch(e){alert("Failed to create on-chain game: "+e.message)}await l.N.from("games").insert([{id:g,white_player:v.wallet_address,white_player_id:v.id,black_player:null,black_player_id:null,fen:"startpos",status:"waiting",wager:t,white_player_rating:v.rating}]),e.push("/chessboard?gameId=".concat(g))}return(0,i.useEffect)(()=>{if(v){var e;let t=null!=(e=v.rating)?e:1200;p(Math.max(0,t-200)),_(t+200)}},[v]),(0,i.useEffect)(()=>{!async function(){if(!I)return;let{data:e,error:t}=await l.N.from("users").select("id, wallet_address, rating, wins, losses, total_pnl, total_wagered, created_at, last_seen").eq("wallet_address",I).single();if(t)return console.error(t);if(e)j(e);else{let{data:e}=await l.N.from("users").insert({wallet_address:I}).select().single();e&&j(e)}}()},[I]),(0,i.useEffect)(()=>{function t(t){if(!t.target||"INPUT"!==t.target.tagName){if("n"===t.key||"N"===t.key)N();else if(("j"===t.key||"J"===t.key)&&S.length){let t=S.find(e=>!e.black_player);t&&e.push("/chessboard?gameId=".concat(t.id))}}}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[S,v]),(0,n.jsxs)("section",{style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"60vh"},children:[(0,n.jsxs)("div",{className:"card",style:{width:500,maxWidth:"100%",margin:"2em 0"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,n.jsx)("h1",{style:{fontSize:"2em",fontWeight:700,marginBottom:"1em"},children:"Game Lobby"}),(0,n.jsx)(m,{})]}),(0,n.jsxs)("div",{style:{marginBottom:16},children:[(0,n.jsx)("label",{style:{marginRight:8},children:"Wager (ETH): "}),(0,n.jsx)("input",{type:"number",min:.01,step:.01,value:t,onChange:e=>a(Number(e.target.value)),style:{width:80,marginRight:16}}),(0,n.jsx)("label",{style:{marginRight:8},children:"Min Rating: "}),(0,n.jsx)("input",{type:"number",min:0,max:b,value:h,onChange:e=>p(Number(e.target.value)),style:{width:60,marginRight:8}}),(0,n.jsx)("label",{style:{marginRight:8},children:"Max Rating: "}),(0,n.jsx)("input",{type:"number",min:h,max:3e3,value:b,onChange:e=>_(Number(e.target.value)),style:{width:60,marginRight:16}})]}),R&&(0,n.jsx)(w.A,{label:"Loading games..."}),(0,n.jsx)(y.A,{message:C}),(0,n.jsx)(x,{onPlay:async()=>{if(!v)return;let t=(0,s.A)();await l.N.from("games").insert([{id:t,white_player:v.wallet_address,white_player_id:v.id,black_player:"BOT",black_player_id:"bot",fen:"startpos",status:"active",wager:0,white_player_rating:v.rating}]),e.push("/chessboard?gameId=".concat(t))}}),(0,n.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:(0,n.jsx)(f,{games:S,onlineUsers:k,loading:R,onCreateGame:N,onJoin:async t=>I?t.white_player===I?void alert("You cannot join your own game."):void(!t.black_player&&(await l.N.from("games").update({black_player:"guest_".concat(Math.floor(1e4*Math.random())),status:"active"}).eq("id",t.id),e.push("/chessboard?gameId=".concat(t.id)))):void alert("Please connect your wallet before joining a game.")})})]}),(0,n.jsx)(g.j,{})]})}},6855:(e,t,a)=>{Promise.resolve().then(a.bind(a,6419))},8007:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=a(5155);a(2115);let i=e=>{let{label:t}=e;return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"2em 0"},"aria-busy":"true",children:[(0,n.jsx)("span",{style:{fontSize:32,marginRight:12},role:"status","aria-label":"Loading",children:"⏳"}),t&&(0,n.jsx)("span",{style:{fontSize:16},children:t})]})}},9884:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var n=a(5155);a(2115);let i=e=>{let{message:t}=e;return t?(0,n.jsx)("div",{className:"error",style:{marginBottom:"1em",background:"#ffebe9",color:"#d32f2f",padding:"8px 16px",borderRadius:4,border:"1px solid #d32f2f"},children:t}):null}}},e=>{var t=t=>e(e.s=t);e.O(0,[134,761,851,219,811,441,684,358],()=>t(6855)),_N_E=e.O()}]);