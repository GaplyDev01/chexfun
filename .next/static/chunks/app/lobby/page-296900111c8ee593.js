(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33],{160:(e,t,a)=>{"use strict";let n;a.r(t),a.d(t,{default:()=>R});var r=a(5881),i=a(6797),l=a(1139),s=a(5982);let o={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},d=new Uint8Array(16),c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));let u=function(e,t,a){if(o.randomUUID&&!t&&!e)return o.randomUUID();let r=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(d)}();if(r.length<16)throw Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((a=a||0)<0||a+16>t.length)throw RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[a+e]=r[e];return t}return function(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}(r)};var g=a(1346),m=a(5036),h=()=>{window.va||(window.va=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];(window.vaq=window.vaq||[]).push(t)})};function f(){return"undefined"!=typeof window}function p(){return"production"}function y(){return(f()?window.vam:p())||"production"}function b(){return"development"===y()}function w(e){return(0,i.useEffect)(()=>{var t;e.beforeSend&&(null==(t=window.va)||t.call(window,"beforeSend",e.beforeSend))},[e.beforeSend]),(0,i.useEffect)(()=>{var t;!function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{debug:!0};if(!f())return;!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto";if("auto"===e){window.vam=p();return}window.vam=e}(t.mode),h(),t.beforeSend&&(null==(e=window.va)||e.call(window,"beforeSend",t.beforeSend));let a=t.scriptSrc?t.scriptSrc:b()?"https://va.vercel-scripts.com/v1/script.debug.js":t.basePath?"".concat(t.basePath,"/insights/script.js"):"/_vercel/insights/script.js";if(document.head.querySelector('script[src*="'.concat(a,'"]')))return;let n=document.createElement("script");n.src=a,n.defer=!0,n.dataset.sdkn="@vercel/analytics"+(t.framework?"/".concat(t.framework):""),n.dataset.sdkv="1.5.0",t.disableAutoTrack&&(n.dataset.disableAutoTrack="1"),t.endpoint?n.dataset.endpoint=t.endpoint:t.basePath&&(n.dataset.endpoint="".concat(t.basePath,"/insights")),t.dsn&&(n.dataset.dsn=t.dsn),n.onerror=()=>{let e=b()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log("[Vercel Web Analytics] Failed to load script from ".concat(a,". ").concat(e))},b()&&!1===t.debug&&(n.dataset.debug="false"),document.head.appendChild(n)}({framework:e.framework||"react",basePath:null!=(t=e.basePath)?t:function(){if(void 0!==m&&void 0!==m.env)return m.env.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}(),...void 0!==e.route&&{disableAutoTrack:!0},...e})},[]),(0,i.useEffect)(()=>{e.route&&e.path&&function(e){var t;let{route:a,path:n}=e;null==(t=window.va)||t.call(window,"pageview",{route:a,path:n})}({route:e.route,path:e.path})},[e.route,e.path]),null}let x=()=>{let[e,t]=i.useState(()=>localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));return i.useEffect(()=>{document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},[e]),(0,r.jsx)("button",{onClick:()=>t("dark"===e?"light":"dark"),style:{background:"var(--accent-2)",color:"#0d1117",borderRadius:6,padding:"6px 16px",fontWeight:600,marginLeft:8},"aria-label":"dark"===e?"Switch to light mode":"Switch to dark mode",title:"dark"===e?"Switch to light mode":"Switch to dark mode",children:"dark"===e?"\uD83C\uDF19 Dark":"☀️ Light"})},v=["#4f8cff","#a259ff","#f24e1e","#43b97f","#fbbc05","#ff6d00"];function _(e){var t;let{name:a}=e,n=function(e){if(!e)return"?";let t=e.split(" ");return t.length>1?t[0][0]+t[1][0]:e.slice(0,2).toUpperCase()}(a),i=v[(null!=(t=null==a?void 0:a.charCodeAt(0))?t:0)%v.length];return(0,r.jsx)("span",{style:{display:"inline-block",width:28,height:28,borderRadius:"50%",background:i,color:"#fff",textAlign:"center",lineHeight:"28px",fontWeight:600,marginRight:8},children:n})}let j=i.memo(e=>{let{games:t,onlineUsers:a,onJoin:n,onCreateGame:l,loading:s}=e,[o,d]=(0,i.useState)("wager"),c=(0,i.useMemo)(()=>{if(!t)return[];switch(o){case"rating":return[...t].sort((e,t)=>(t.white_player_rating||0)-(e.white_player_rating||0));case"status":return[...t].sort((e,t)=>e.status.localeCompare(t.status));default:return[...t].sort((e,t)=>t.wager-e.wager)}},[t,o]);return s?(0,r.jsx)("li",{style:{textAlign:"center",padding:"2em 0"},"aria-busy":"true",children:"Loading games..."}):c.length?(0,r.jsxs)("ul",{style:{listStyle:"none",padding:0,margin:0},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",margin:"8px 0 16px 0"},children:[(0,r.jsx)("label",{htmlFor:"sort-games",style:{marginRight:8},children:"Sort by:"}),(0,r.jsxs)("select",{id:"sort-games",value:o,onChange:e=>d(e.target.value),style:{marginRight:16},"aria-label":"Sort games",children:[(0,r.jsx)("option",{value:"wager",children:"Wager"}),(0,r.jsx)("option",{value:"rating",children:"Rating"}),(0,r.jsx)("option",{value:"status",children:"Status"})]})]}),c.map(e=>(0,r.jsxs)("li",{className:"card",tabIndex:0,style:{marginBottom:"1.5em",padding:"1em 1.5em",display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--card-bg)",border:"1px solid var(--accent)",boxShadow:"0 0 12px #4f8cff33"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,r.jsx)(_,{name:e.white_player}),(0,r.jsx)("span",{style:{fontWeight:600,color:"var(--accent-2)"},children:"Game ID:"})," ",(0,r.jsxs)("span",{style:{fontFamily:"var(--font-mono)",fontSize:"1.1em"},children:[e.id.slice(0,8),"..."]}),(0,r.jsx)("br",{}),(0,r.jsxs)("span",{style:{color:"var(--foreground)",fontSize:"0.95em",marginLeft:8},children:["White: ",(0,r.jsx)("b",{children:e.white_player})," ",e.white_player&&a.includes(e.white_player)?"\uD83D\uDFE2":"⚪"," ",e.black_player?"vs ":""]}),e.black_player&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_,{name:e.black_player}),(0,r.jsxs)("span",{style:{fontSize:"0.95em"},children:[(0,r.jsx)("b",{children:e.black_player})," ",a.includes(e.black_player)?"\uD83D\uDFE2":"⚪"]})]})]}),(0,r.jsx)("button",{style:{background:"var(--accent-2)",color:"#0d1117",minWidth:100},onClick:()=>n(e),disabled:!!e.black_player,"aria-label":e.black_player?"Game already joined":"Join this game",title:e.black_player?"This game already has two players.":"Join this game",children:"Join"})]},e.id))]}):(0,r.jsxs)("li",{style:{color:"var(--foreground)",textAlign:"center",padding:"2em 0"},children:["No games available.",(0,r.jsx)("br",{}),l&&(0,r.jsx)("button",{onClick:l,style:{marginTop:12,background:"var(--accent-2)",color:"#0d1117",fontWeight:600,padding:"8px 20px",borderRadius:6},"aria-label":"Create new game",title:"Create a new game",children:"+ Create Game"})]})}),k=e=>{let{message:t}=e;return t?(0,r.jsx)("div",{className:"error",style:{marginBottom:"1em",background:"#ffebe9",color:"#d32f2f",padding:"8px 16px",borderRadius:4,border:"1px solid #d32f2f"},children:t}):null},S=e=>{let{label:t}=e;return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"2em 0"},"aria-busy":"true",children:[(0,r.jsx)("span",{style:{fontSize:32,marginRight:12},role:"status","aria-label":"Loading",children:"⏳"}),t&&(0,r.jsx)("span",{style:{fontSize:16},children:t})]})},I=e=>{let{onPlay:t}=e;return(0,r.jsx)("button",{onClick:t,style:{background:"var(--accent-2)",color:"#0d1117",fontWeight:600,padding:"8px 20px",borderRadius:6,margin:"8px 0"},"aria-label":"Play vs Bot",title:"Play a game against a computer bot",children:"\uD83E\uDD16 Play vs Bot"})};function R(){let e=(0,l.useRouter)(),[t,a]=(0,i.useState)(.01),[n,o]=(0,i.useState)(0),[d,c]=(0,i.useState)(3e3),[m,h]=(0,i.useState)(null),{address:f}=(0,g.DK)(),p=function(e){let[t,a]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let t,n;if(e)return r(),i(),t=setInterval(r,3e4),n=setInterval(i,3e4),()=>{clearInterval(t),clearInterval(n)};async function r(){await s.N.from("users").update({last_seen:new Date().toISOString()}).eq("wallet_address",e)}async function i(){let{data:e}=await s.N.from("users").select("wallet_address,last_seen"),t=Date.now();a((e||[]).filter(e=>e.last_seen&&t-new Date(e.last_seen).getTime()<12e4).map(e=>e.wallet_address))}},[e]),t}(null!=f?f:null),{games:y,loading:b,error:v}=function(e,t){let[a,n]=(0,i.useState)([]),[r,l]=(0,i.useState)(!0),[o,d]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let t=s.N.from("games").select("*");e.status&&(t=t.eq("status",e.status)),e.wager&&(t=t.gte("wager",.8*e.wager).lte("wager",1.2*e.wager)),t.then(t=>{let{data:a,error:r}=t;if(r)d(r.message);else{let t=a||[];void 0!==e.minRating&&void 0!==e.maxRating&&(t=t.filter(t=>null===t.white_player_rating||t.white_player_rating>=e.minRating&&t.white_player_rating<=e.maxRating)),n(t)}l(!1)})},[e.status,e.minRating,e.maxRating,e.wager,t]),{games:a,loading:r,error:o}}({status:"waiting",minRating:n,maxRating:d,wager:t},null==m?void 0:m.id);async function _(){if(!m)return;let a=u();await s.N.from("games").insert([{id:a,white_player:m.wallet_address,white_player_id:m.id,black_player:null,black_player_id:null,fen:"startpos",status:"waiting",wager:t,white_player_rating:m.rating}]),e.push("/chessboard?gameId=".concat(a))}return(0,i.useEffect)(()=>{m&&(o(Math.max(0,m.rating-200)),c(m.rating+200))},[m]),(0,i.useEffect)(()=>{!async function(){if(!f)return;let{data:e}=await s.N.from("users").select("id, wallet_address, rating, wins, losses, total_pnl, total_wagered, created_at, last_seen").eq("wallet_address",f).single();if(e)h(e);else{let{data:e}=await s.N.from("users").insert({wallet_address:f}).select().single();h(e)}}()},[f]),(0,i.useEffect)(()=>{function t(t){if(!t.target||"INPUT"!==t.target.tagName){if("n"===t.key||"N"===t.key)_();else if(("j"===t.key||"J"===t.key)&&y.length){let t=y.find(e=>!e.black_player);t&&e.push("/chessboard?gameId=".concat(t.id))}}}return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[y,m]),(0,r.jsxs)("section",{style:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"60vh"},children:[(0,r.jsxs)("div",{className:"card",style:{width:500,maxWidth:"100%",margin:"2em 0"},children:[(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)("h1",{style:{fontSize:"2em",fontWeight:700,marginBottom:"1em"},children:"Game Lobby"}),(0,r.jsx)(x,{})]}),(0,r.jsxs)("div",{style:{marginBottom:16},children:[(0,r.jsx)("label",{style:{marginRight:8},children:"Wager (ETH): "}),(0,r.jsx)("input",{type:"number",min:.01,step:.01,value:t,onChange:e=>a(Number(e.target.value)),style:{width:80,marginRight:16}}),(0,r.jsx)("label",{style:{marginRight:8},children:"Min Rating: "}),(0,r.jsx)("input",{type:"number",min:0,max:d,value:n,onChange:e=>o(Number(e.target.value)),style:{width:60,marginRight:8}}),(0,r.jsx)("label",{style:{marginRight:8},children:"Max Rating: "}),(0,r.jsx)("input",{type:"number",min:n,max:3e3,value:d,onChange:e=>c(Number(e.target.value)),style:{width:60,marginRight:16}})]}),b&&(0,r.jsx)(S,{label:"Loading games..."}),(0,r.jsx)(k,{message:v}),(0,r.jsx)(I,{onPlay:async()=>{if(!m)return;let t=u();await s.N.from("games").insert([{id:t,white_player:m.wallet_address,white_player_id:m.id,black_player:"BOT",black_player_id:"bot",fen:"startpos",status:"active",wager:0,white_player_rating:m.rating}]),e.push("/chessboard?gameId=".concat(t))}}),(0,r.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:(0,r.jsx)(j,{games:y,onlineUsers:p,loading:b,onCreateGame:_,onJoin:async t=>{t.black_player||(await s.N.from("games").update({black_player:"guest_".concat(Math.floor(1e4*Math.random())),status:"active"}).eq("id",t.id),e.push("/chessboard?gameId=".concat(t.id)))}})})]}),(0,r.jsx)(w,{})]})}},5982:(e,t,a)=>{"use strict";a.d(t,{N:()=>n});let n=(0,a(907).UU)("https://ospgpgpahqgalaufcomo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9zcGdwZ3BhaHFnYWxhdWZjb21vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU1NzYzMzIsImV4cCI6MjA2MTE1MjMzMn0.houQzJX0k4S9MbnPODy13rK8oIXq-QwuuRxD9lOjE9s")},6785:(e,t,a)=>{Promise.resolve().then(a.bind(a,160))}},e=>{var t=t=>e(e.s=t);e.O(0,[346,907,364,770,358],()=>t(6785)),_N_E=e.O()}]);